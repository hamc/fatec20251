name: Testes MicroserviÃ§o Produtos

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ”„ Clonar repositÃ³rio
      uses: actions/checkout@v4

    - name: ğŸ”§ Instalar dependÃªncias
      run: npm install

    - name: â–¶ï¸ Iniciar servidor em background
      run: |
        node app.js &
        sleep 3

    - name: ğŸ§ª Testar rota /products/check com produto existente (id=101)
      run: |
        RESPONSE=$(curl -s http://localhost:3000/products/check?productId=101)
        echo "Resposta da API: $RESPONSE"
        echo "$RESPONSE" | grep '"available":true' || (echo "âŒ Falha no teste: produto deveria estar disponÃ­vel" && exit 1)

    - name: ğŸ§ª Testar rota /products/check com produto inexistente (id=999)
      run: |
        STATUS=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/products/check?productId=999)
        echo "Status da API: $STATUS"
        [ "$STATUS" -eq 404 ] || (echo "âŒ Falha no teste: deveria retornar 404" && exit 1)

    - name: âœ… Todos os testes passaram
      run: echo "âœ”ï¸ Testes executados com sucesso!"
